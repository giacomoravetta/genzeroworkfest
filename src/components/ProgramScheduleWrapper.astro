---
import ProgramSchedule from "./ProgramSchedule.svelte";
import { getProgramData } from "../lib/notion";

// Disable prerendering to get fresh data on each request
export const prerender = false;

// For Cloudflare Pages, environment variables are accessed via Astro.locals.runtime.env
// They should be set in Cloudflare Pages dashboard under Settings > Environment variables

// Try multiple ways to access environment variables
let notionApiKey: string | undefined;
let notionDatabaseId: string | undefined;

// Method 1: Try Astro.locals.runtime.env (Cloudflare Workers/Pages)
if (Astro.locals.runtime?.env) {
    notionApiKey = Astro.locals.runtime.env.NOTION_API_KEY;
    notionDatabaseId = Astro.locals.runtime.env.NOTION_DATABASE_ID;
}

// Method 2: Fallback to import.meta.env for local development
if (!notionApiKey) {
    notionApiKey = import.meta.env.NOTION_API_KEY;
    notionDatabaseId = import.meta.env.NOTION_DATABASE_ID;
}

// Fetch data server-side
const data = await getProgramData(notionApiKey, notionDatabaseId);
---

<section
    class="relative flex flex-col justify-center items-start w-full h-auto px-4 sm:px-6 lg:px-40 pt-8 sm:pt-12 lg:pt-16"
>
    <ProgramSchedule client:only="svelte" {data} />
</section>
